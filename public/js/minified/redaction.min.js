jQuery(document).ready(function(e){function i(){u=p.socket.sessionid,console.log("Connected "+u)}function n(e){console.log("incomingLine",e),m(e)}function t(i){console.log("new image :: data",i);var n=e('.editor .images[foldername="'+i.folder+'"] .thumbs'),t=e('.editor .images[foldername="'+i.folder+'"] select'),s=Math.floor(n.find("img:last").attr("index"))+1;n.addClass("new-image").append(e("<img>").addClass("thumb").attr("index",s).attr("alt","").attr("src",i.src).hide()),n.removeClass("new-image"),t.append(e("<option>").attr("index",s).attr("value",i.img).html(i.img))}function s(e){console.log("Unable to connect to server",e)}function a(){var i={};i.session=app.session,i.legend=e("#legend").val(),i.images={},e(".editor .images").each(function(n){i["image-"+e(this).attr("foldername")]=e(this).hasClass("selected")?e(this).find('option[selected="selected"]').val():!1}),e.ajax({url:"/newline",type:"POST",dataType:"json",data:i})}function o(i){var n;i.deltaY>0?n=e(this).find("img:visible").next().size()?e(this).find("img:visible").next():e(this).find("img:first-child"):i.deltaY<0&&(n=e(this).find("img:visible").prev().size()?e(this).find("img:visible").prev():e(this).find("img:last-child")),d(e(this).parents(".images"),parseInt(n.attr("index")))}function l(i){console.log("onImageRangeChange"),d(e(this).parents(".images"),e(this).val()-1)}function d(i,n){console.log("changeVisibleImage",n),i.find("img").hide(),e('img[index="'+n+'"]',i).show(),e("option",i).removeAttr("selected"),e('select option[index="'+n+'"]',i).attr("selected",!0),e('input[type="range"]',i).val(n+1)}function r(){console.log("onToggleImage"),e(this).parents(".images").toggleClass("selected")}function c(e){switch(e.key){case"Up":case"Right":case"Down":case"Left":g(e)}}function g(i){i.preventDefault();var n=e("#recordedlines .images.highlight").length>0?e("#recordedlines .images.highlight:first"):null;if(null===n)var t=0,s=0;else{var t=n.index(),s=n.parents(".record").index();switch(i.key){case"Up":s--;break;case"Right":t++;break;case"Down":s++;break;case"Left":t--}}h(t,s)}function h(i,n){console.log("x: ",i),console.log("y: ",n),e(".highlight").removeClass("highlight"),e("#recordedlines .record:nth-child("+n+") .images:nth-child("+i+")").addClass("highlight")}function m(i){var n=e("<article>").addClass("record row lead").append(e("<p>").addClass("legend col-xs-3").html(i.legend));for(folder in i.images){var t=e("<div>").addClass("col-xs-3");if(console.log(i.images[folder]),"false"!=i.images[folder]){var s="/"+i.session+"/"+folder+"/"+i.images[folder];t.append(e("<img>").addClass("thumb").attr("src",s))}n.append(t)}n.appendTo("#content")}var f=document.domain,p=io.connect(f),u="";p.on("connect",i),p.on("incomingLine",n),p.on("error",s),p.on("newImage",t),e("#send").on("click",a),e(".editor .thumbs").on("mousewheel",o),e('.editor input[type="range"]').on("change",l),e(".btn[data-toggle]").on("click",r)});