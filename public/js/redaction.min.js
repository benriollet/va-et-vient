jQuery(document).ready(function(n){function e(){g=m.socket.sessionid,console.log("Connected "+g)}function o(n){console.log("incomingLine",n),d(n)}function t(e){console.log("new image :: data",e);var o=n('.column.images[foldername="'+e.folder+'"] .thumbs'),t=n('.column.images[foldername="'+e.folder+'"] select'),i=Math.floor(o.find("img:last").attr("index"))+1;o.addClass("new-image").append(n("<img>").addClass("thumb").attr("index",i).attr("alt","").attr("src",e.src).hide()),o.removeClass("new-image"),t.append(n("<option>").attr("index",i).attr("value",e.img).html(e.img))}function i(n){console.log("Unable to connect to server",n)}function a(){var e={};e.session=app.session,e.legend=n("#legend").val(),e.images={},n("#lineForm .column.images").each(function(){e["image-"+n(this).attr("foldername")]=n(this).find('option[selected="selected"]').val()}),console.log("data",e),n.ajax({url:"/newline",type:"POST",dataType:"json",data:e})}function s(e){var o;e.deltaY>0?o=n(this).find("img:visible").next().size()?n(this).find("img:visible").next():n(this).find("img:first-child"):e.deltaY<0&&(o=n(this).find("img:visible").prev().size()?n(this).find("img:visible").prev():n(this).find("img:last-child")),l(n(this).parents(".column"),parseInt(o.attr("index")))}function c(){console.log("onImageRangeChange"),l(n(this).parents(".column"),n(this).val()-1)}function l(e,o){console.log("changeVisibleImage",o),e.find("img").hide(),n('img[index="'+o+'"]',e).show(),n("option",e).removeAttr("selected"),n('select option[index="'+o+'"]',e).attr("selected",!0),n('input[type="range"]',e).val(o+1)}function d(e){var o=n("<article>").addClass("record row lead").append(n("<p>").addClass("legend column col-xs-3").html(e.legend));for(folder in e.images){var t="/"+e.session+"/"+folder+"/"+e.images[folder];o.append(n("<div>").addClass("column col-xs-3").append(n("<img>").addClass("thumb").attr("src",t)))}o.appendTo("#recordedlines")}var r=document.domain,m=io.connect(r),g="";m.on("connect",e),m.on("incomingLine",o),m.on("error",i),m.on("newImage",t),n("#send").on("click",a),n(".column .thumbs").on("mousewheel",s),n('.column input[type="range"]').on("change",c)});